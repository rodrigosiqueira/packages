Description: Fixed crash while loading video clip
 - Original comment: Patch for CVE-2009-3378 while waiting for upstream to apply
Author: John Francesco Ferlito <johnf@inodes.org>
Bug: https://bugzilla.mozilla.org/show_bug.cgi?id=500311

--- a/src/liboggplay/oggplay.c
+++ b/src/liboggplay/oggplay.c
@@ -169,6 +169,7 @@
   for (i = 0; i < me->num_tracks; i++) {
     me->decode_data[i]->active = 0;
   }
+  me->active_tracks = 0;
 
   /*
    * if the buffer was set up before initialisation, prepare it now
--- a/src/liboggplay/oggplay_callback.c
+++ b/src/liboggplay/oggplay_callback.c
@@ -65,6 +65,7 @@
   decoder->convert_to_rgb = 0;
   decoder->swap_rgb = 0;
   decoder->decoder.decoded_type = OGGPLAY_YUV_VIDEO;
+  decoder->decoder.player->active_tracks++;
 }
 
 void
@@ -507,6 +508,7 @@
                                    (void *)decoder);
 
   decoder->decoder.decoded_type = OGGPLAY_FLOATS_AUDIO;
+  decoder->decoder.player->active_tracks++;
 }
 
 void
